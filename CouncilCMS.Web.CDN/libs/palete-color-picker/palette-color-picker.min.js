(function(n){"use strict";n.paletteColorPicker=function(t,i){var f="palette-color-picker",u=n(t),r=this,h=u.val(),c=u.attr("name"),o=n("<div>").addClass(f+"-button").attr("data-target",c),e=n("<div>").addClass(f+"-bubble"),l={custom_class:null,colors:null,position:"upside",insert:"before",clear_btn:"first",timeout:2e3},s="ontouchstart"in document.documentElement?"touchstart":"click";r.init=function(){var t,c;r.settings=n.extend({},l,i);t=u.attr("value");(typeof t==typeof undefined||t===!1)&&(t="",u.attr("value",t));u.attr("data-initialvalue",u.attr("value"));r.settings.colors===null&&(r.settings.colors=u.data("palette"));typeof r.settings.colors[0]=="string"&&(r.settings.colors=n.map(r.settings.colors,function(n){var t={};return t[n]=n,t}));r.settings.insert=r.settings.insert.charAt(0).toUpperCase()+r.settings.insert.slice(1);r.settings.custom_class&&e.addClass(r.settings.custom_class);n.each(r.settings.colors,function(t,i){var r=Object.keys(i)[0],u=i[r],f=n("<span>").addClass("swatch").attr({title:r,"data-color":u,"data-name":r}).css("background-color",u);r===h&&(f.addClass("active"),o.css("background",u));f.appendTo(e)});r.settings.clear_btn!==null&&(c=n("<span>").addClass("swatch clear").attr("title","Clear selection"),r.settings.clear_btn==="last"?c.addClass("last").appendTo(e):c.prependTo(e));r.destroy=function(){o.remove();n.removeData(u[0])};r.clear=function(){e.find(".active").removeClass("active");o.removeAttr("style");u.val("")};r.reset=function(){if(u.attr("data-initialvalue")==="")r.clear();else{var n=u.attr("data-initialvalue");e.find('[data-name="'+n+'"]').trigger("click")}};o.append(e).on(s,function(t){t.preventDefault();t.stopPropagation();var i=n(this);i.toggleClass("active").find("."+f+"-bubble").fadeToggle();i.hasClass("active")&&(clearTimeout(r.timer),r.timer=setTimeout(function(){i.trigger("pcp.fadeout")},r.settings.timeout))}).on("pcp.fadeout",function(){n(this).removeClass("active").find("."+f+"-bubble").fadeOut()}).on("mouseenter","."+f+"-bubble",function(){clearTimeout(r.timer)}).on("mouseleave","."+f+"-bubble",function(){r.timer=setTimeout(function(){o.trigger("pcp.fadeout")},r.settings.timeout)}).on(s,"span.swatch",function(t){t.preventDefault();t.stopPropagation();var r=n(this).attr("data-color"),u=n(this).attr("data-name"),i=n("."+f+'-button[data-target="'+n(this).closest("."+f+"-button").attr("data-target")+'"]'),e=n(this).closest("."+f+"-bubble");e.find(".active").removeClass("active");n(t.target).is(".clear")?(i.removeAttr("style"),r=""):(n(this).addClass("active"),i.css("background",r));n('[name="'+i.attr("data-target")+'"]').val(u)})["insert"+r.settings.insert](u);(r.settings.position==="downside"||u.offset().top+20<e.outerHeight())&&e.addClass("downside")};r.init()};n.fn.paletteColorPicker=function(t){return this.each(function(){typeof n(this).data("paletteColorPickerPlugin")=="undefined"&&n(this).data("paletteColorPickerPlugin",new n.paletteColorPicker(this,t))})}})(jQuery);